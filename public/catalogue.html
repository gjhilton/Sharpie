<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Character Catalogue - Sharpie</title>
		<style>
			body {
				font-family:
					system-ui,
					-apple-system,
					sans-serif;
				max-width: 1200px;
				margin: 0 auto;
				padding: 2rem;
				background: #f5f5f5;
			}
			h1 {
				font-size: 3rem;
				margin-bottom: 2rem;
			}
			.graphset {
				margin-bottom: 5rem;
			}
			.graphset h2 {
				font-size: 1.5rem;
				border-bottom: 2px solid black;
				padding-bottom: 0.5rem;
				margin-bottom: 2rem;
			}
			.character {
				margin-bottom: 3rem;
			}
			.character h3 {
				font-size: 1.25rem;
				margin-bottom: 1rem;
			}
			.images {
				display: grid;
				grid-template-columns: repeat(4, 1fr);
				gap: 0.5rem;
			}
			.image-container {
				display: flex;
				flex-direction: column;
				align-items: center;
				gap: 0.25rem;
			}
			.image-box {
				width: 120px;
				height: 120px;
				background: white;
				border: 1px solid #ddd;
				border-radius: 4px;
				display: flex;
				align-items: center;
				justify-content: center;
				padding: 0.5rem;
			}
			.image-box img {
				max-width: 100%;
				max-height: 100%;
				object-fit: contain;
			}
			.source {
				font-size: 0.75rem;
				color: #666;
			}
			.back-link {
				margin-bottom: 2rem;
				display: inline-block;
				color: #333;
				text-decoration: underline;
			}
			.back-link:hover {
				text-decoration: none;
			}
		</style>
	</head>
	<body>
		<a href="./" class="back-link">‚Üê Return to Menu</a>
		<h1>Character Catalogue</h1>

		<div id="catalogue"></div>

		<script type="module">
			import { DB } from './src/data/DB.js';

			const sources = DB.sources;
			const graphSets = DB.graphSets;

			function getImagePath(graph) {
				return `./data/${graph.img}`;
			}

			function groupGraphsByCharacter(graphs) {
				const characterMap = {};
				graphs.forEach(graph => {
					if (!characterMap[graph.character]) {
						characterMap[graph.character] = [];
					}
					characterMap[graph.character].push(graph);
				});

				const sortedCharacters = Object.keys(characterMap).sort(
					(a, b) => a.localeCompare(b)
				);

				return sortedCharacters.map(char => ({
					character: char,
					graphs: characterMap[char],
				}));
			}

			const catalogueEl = document.getElementById('catalogue');

			graphSets.forEach(graphSet => {
				const characters = groupGraphsByCharacter(graphSet.graphs);

				const graphsetDiv = document.createElement('div');
				graphsetDiv.className = 'graphset';

				const h2 = document.createElement('h2');
				h2.textContent = graphSet.title;
				graphsetDiv.appendChild(h2);

				characters.forEach(({ character, graphs }) => {
					const charDiv = document.createElement('div');
					charDiv.className = 'character';

					const h3 = document.createElement('h3');
					h3.textContent = character;
					charDiv.appendChild(h3);

					const imagesDiv = document.createElement('div');
					imagesDiv.className = 'images';

					graphs.forEach(graph => {
						const imgContainer = document.createElement('div');
						imgContainer.className = 'image-container';

						const imgBox = document.createElement('div');
						imgBox.className = 'image-box';

						const img = document.createElement('img');
						const imagePath = getImagePath(graph);
						img.src = imagePath;
						img.alt = character;
						img.onerror = function () {
							console.error('Failed to load:', imagePath);
							this.style.border = '2px solid red';
						};

						imgBox.appendChild(img);
						imgContainer.appendChild(imgBox);

						const source = document.createElement('div');
						source.className = 'source';
						source.textContent =
							sources[graph.source]?.title || 'Unknown';
						imgContainer.appendChild(source);

						imagesDiv.appendChild(imgContainer);
					});

					charDiv.appendChild(imagesDiv);
					graphsetDiv.appendChild(charDiv);
				});

				catalogueEl.appendChild(graphsetDiv);
			});
		</script>
	</body>
</html>
